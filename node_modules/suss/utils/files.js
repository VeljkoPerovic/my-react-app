/**
 * Created by franco on 09/09/2016.
 * Utilitário para Tratamentos de arquivos e diretórios
 */

var fs = require('fs');
var path = require('path');

// --------------------------------------------------
// CONFIGURATIONS
// --------------------------------------------------

// --------------------------------------------------
// METHODS
// --------------------------------------------------

/**
 * Verifica se um diretório está ou não vazio
 * @param path
 * @param callback
 */
function emptyDirectory(path, callback) {
    fs.readdir(path, function (err, files) {
        if (err && 'ENOENT' != err.code) throw err;
        callback(!files || !files.length);
    });
}

/**
 * Verifica se um arquivo é um Javascript
 * @param filePath
 */
function checkIsJS(filePath) {
    filePath.match(/\.js$/);
}

/**
 * Vasculha um diretório e seus subdiretórios a procura de arquivos Javascript
 * @param startDir
 * @param callback
 */
function walkJS(startDir, callback) {
    walker(startDir, checkIsJS, callback);
}

/**
 * Percorre os diretórios a procura de um tipo de arquivo
 * @param currentDir
 * @param checkByRegex
 * @param callback
 */
function walker(currentDir, checkByRegex, callback) {

    // Verifica se o diretório existe
    console.log(currentDir, 'exists', fs.existsSync(currentDir));
    if (fs.existsSync(currentDir)) {
        fs.readdirSync(currentDir).forEach(function (fileName) {
            console.log('file name', fileName);

            // Path final
            var filePath = path.join(currentDir, fileName);
            console.log('file path', filePath);

            // Diretório
            if (fs.lstatSync(filePath).isDirectory()) {
                walker(filePath, checkByRegex, callback);
            } else {
                if (checkByRegex(fileName)) {
                    callback(fileName, currentDir, filePath);
                }
            }
        });
    }
}

// --------------------------------------------------
// EXPORTS
// --------------------------------------------------

module.exports.emptyDirectory = emptyDirectory;
module.exports.walJS = walkJS;